class HttpServices{_handleErrors(n){if(n.ok)return n;throw new Error(n.statusText);}_get(n){return fetch(n).then(n=>this._handleErrors(n)).then(n=>n.json())}_post(n,t){return fetch(n,{headers:{"Content-type":"application/json"},method:"post",body:JSON.stringify(t)}).then(this._handleErrors).then(n=>n.json()).catch(n=>{console.log(n)})}}class QuestionServices{constructor(){this._dao=new QuestionDao}add(n){return this._dao.add(n).then(n=>n).catch(n=>console.log(n))}list(n){return this._dao.list(n).then(n=>n).catch(n=>console.log(n))}}class Arrays{constructor(){throw new Error("This is a Static Class, cannot be intanciate!");}static randomArray(n,t){for(var i=n.length,u,r;0!==i;)r=Math.floor(Math.random()*i),i-=1,u=n[i],n[i]=n[r],n[r]=u;return n.sort((n,t)=>n>t).slice(0,t==0?n.length:t)}}class Question{constructor(n,t,i,r,u){this._description=n;this._tips=t;this._answer=i;this._categoryid=r;this._seconds=u;this._published=!1;Object.freeze(this)}get description(){return this._description}get tips(){return this._tips}get answer(){return this._answer}get seconds(){return this._seconds}}class QuestionDao{constructor(){this._http=new HttpServices;this._baseUrl="/api/Question"}add(n){return new Promise((t,i)=>{this._http._post(this._baseUrl,n).then(n=>{t(n)}).catch(n=>{console.log(n),i("Somethings is wrong")})})}list(n){return new Promise((t,i)=>{this._http._get(this._baseUrl+"/"+n.toString()).then(n=>{t(n)}).catch(n=>{console.log(n),i("Somethings is wrong")})})}}class View{constructor(n){this._elemento=n}template(){throw new Error("Have be implement!");}update(n){this._elemento.innerHTML=this.template(n)}}class QuestionView extends View{constructor(n){super(n)}template(n){return n.length==0?`
            <div id="accordions">
               <p class="small text-info">
                    Oh Jezz! Seem there not question for this category, sorry, but, hey you can contribute! yea!!
                    start send questioin <a data-toggle="modal" data-target="#sendquestion" href="#">here</a>.
                </p>
            </div>
            `:`
        <div id="accordions">
                    ${n.map(n=>`
                        <div class="d-flex p-1 card font-weight-light">
                            <div class="card-header" id="${n.id}">
                            <div class="row">
                               <div class="col-md-8 text-left">
                               <p class="text-success text-left font-weight-light">${n.description}</p> 
                               </div>
                               <div class="col-md-4 text-center">
                                   <div class="row">
                                        <div class="col-6">
                                            <button class="btn btn-info text-left" data-toggle="collapse" data-target="#collapse${n.id}" aria-expanded="true" aria-controls="collapse${n.id}">
                                              Answer/Tips
                                            </button>
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-warning text-left">
                                              Record yourself
                                            </button>
                                        </div>
                                        <hr>
                                        <div class="col-md-12">
                                           <i class="small text-muted text-left font-weight-light">${n.seconds>0?`You have ${n.seconds} seconds to response this question.`:""} </i>
                                        </div>
                                   </div>
                               </div>
                            </div>
                            </div>
                            <div id="collapse${n.id}" class="collapse" aria-labelledby="${n.id}" data-parent="#accordion">
                                <div class="card-body">
                                ${n.answer.replace(/(?:\r\n|\r|\n)/g,"<br>")}
                                <br>
                                <br>
                                ${n.tips.replace(/(?:\r\n|\r|\n)/g,"<br>")}
                                </div>
                            </div>
                        </div>
                     `).join("")}
        </div>
      `}}class QuestionController{constructor(){this._services=new QuestionServices;this._view=new QuestionView(document.querySelector("#results"));let n=document.querySelector("#formQuestion"),t=document.querySelector("#categoryIdRandom"),i=document.querySelector("#maxQuestion");this._question=n.question;this._time=n.time;this._categoryId=n.categoryId;this._categoryIdRandom=t;this._maxQuestion=i;this._tips=n.tips;this._answare=n.answare;this._listOfQuestion=[];this._init()}_init(){}_createQuestion(){return new Question(this._question.value,this._tips.value,this._answare.value,this._categoryId.value,this._time.value?this._time.value:0)}add(n){n.preventDefault();this._services.add(this._createQuestion()).then(n=>{if(!n)throw Error("Something is Wrong");return console.log("Add Success Id : ("+n.id+")"),this.clean(n.id),n}).catch(n=>{document.querySelector("#msg").className="danger",document.querySelector("#msg").textContent=n,console.log(n)})}clean(n){this._question.value="";this._tips.value="";this._answare.value="";this._time.value="";document.querySelector("#msg").textContent=`It's awesome! Question ${n} add successfully`;setTimeout(()=>{document.querySelector("#msg").textContent=""},3e3)}random(n){n.preventDefault();this._services.list(this._categoryIdRandom.value).then(n=>(this._updateView(Arrays.randomArray(n,this._maxQuestion.value)),n)).catch(n=>{document.querySelector("#msg").className="danger",document.querySelector("#msg").textContent=n,console.log(n)})}_updateView(n){this._view.update(n)}}